<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOVE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        #canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        #textCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            pointer-events: none;
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: transparent;
            border: 3px solid #FF1493;
            border-radius: 50%;
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #FF1493;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.3);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .play-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 50px rgba(255, 20, 147, 0.8);
        }

        .play-button.hidden {
            display: none;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 30px rgba(255, 20, 147, 0.5);
            }
            50% {
                box-shadow: 0 0 50px rgba(255, 20, 147, 0.8);
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <canvas id="textCanvas"></canvas>
    
    <!-- Nút Play -->
    <button class="play-button" id="playButton">▶</button>
    
    <!-- Nhạc nền -->
    <audio id="backgroundMusic" loop>
        <source src="src/mp3/yeunam.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Matrix characters - i love you ngoc han, trái tim, tiếng Nhật và ký tự hacker
        const matrix = "iloveyoungochan♥♡❤ILOVEYOUNGOCHANiloveuあいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんアイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+-=[]{}|;:,.<>?/~`あかさたなはまやらわいきしちにひみりうくすつぬふむゆるえけせてねへめれおこそとのほもよろを";
        const matrixArray = matrix.split('');

        const fontSize = 24;
        const columns = canvas.width / fontSize;

        // Create array for drops
        const drops = [];
        for (let i = 0; i < columns; i++) {
            drops[i] = Math.floor(Math.random() * canvas.height / fontSize);
        }

        // Create array for colors - NHIỀU MÀU SẮC
        const matrixColors = [
            '#FF0080', // Hồng đậm
            '#FF69B4', // Hồng
            '#FF1493', // Hồng đậm
            '#FF00FF', // Magenta
            '#FF00CC', // Hồng tím
            '#CC00FF', // Tím
            '#9900FF', // Tím đậm
            '#6600FF', // Tím xanh
            '#0099FF', // Xanh dương
            '#00CCFF', // Xanh nhạt
            '#00FFFF', // Cyan
            '#00FF99', // Xanh lá nhạt
            '#00FF00', // Xanh lá
            '#FFFF00', // Vàng
            '#FFD700', // Vàng kim
            '#FFA500', // Cam
            '#FF6600', // Cam đậm
            '#FF0000', // Đỏ
            '#FF3366', // Đỏ hồng
            '#FFFFFF'  // Trắng
        ];

        function draw() {
            // Semi-transparent black to create trail effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                // Random character
                const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
                
                // Random color from green shades
                const color = matrixColors[Math.floor(Math.random() * matrixColors.length)];
                ctx.fillStyle = color;

                // Draw character
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                // Reset drop to top randomly
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }

                // Move drop down
                drops[i]++;
            }
        }

        // Animation loop
        setInterval(draw, 35);

        // Resize canvas on window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            textCanvas.width = window.innerWidth;
            textCanvas.height = window.innerHeight;
        });

        // ============ PARTICLE TEXT ANIMATION ============
        const textCanvas = document.getElementById('textCanvas');
        const textCtx = textCanvas.getContext('2d');
        textCanvas.width = window.innerWidth;
        textCanvas.height = window.innerHeight;

        const words = ['Chúc', 'Cậu', 'buổi', 'Sáng', 'Vui', 'Vẻ', 'Nha'];
        let currentWordIndex = 0;
        let particles = [];
        let isCountingDown = true;
        let countdownIndex = 0;
        let hasStarted = false;
        const countdownNumbers = ['3', '2', '1'];

        // Particle class
        class Particle {
            constructor(x, y, targetX, targetY, color) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.color = color;
                this.size = 1.5;
                // Tăng tốc độ và random hướng bay để particles tan khắp màn hình
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 30 + 20;
                this.speedX = Math.cos(angle) * speed;
                this.speedY = Math.sin(angle) * speed;
                this.friction = 0.92;
                this.ease = 0.12; // Tăng tốc độ gộp lại nhanh hơn
                this.isExploding = false;
            }

            update() {
                if (this.isExploding) {
                    this.speedX *= this.friction;
                    this.speedY *= this.friction;
                    this.x += this.speedX;
                    this.y += this.speedY;
                } else {
                    let dx = this.targetX - this.x;
                    let dy = this.targetY - this.y;
                    this.x += dx * this.ease;
                    this.y += dy * this.ease;
                }
            }

            draw() {
                textCtx.fillStyle = this.color;
                textCtx.shadowBlur = 20;
                textCtx.shadowColor = this.color;
                textCtx.beginPath();
                textCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                textCtx.fill();
            }

            explode() {
                this.isExploding = true;
            }

            setTarget(x, y) {
                this.targetX = x;
                this.targetY = y;
                this.isExploding = false;
            }
        }

        // Lấy pixels từ text
        function getTextPixels(text) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            const fontSize = 120;
            tempCtx.font = `bold ${fontSize}px Arial`;
            
            const metrics = tempCtx.measureText(text);
            tempCanvas.width = metrics.width + 50;
            tempCanvas.height = fontSize + 50;
            
            tempCtx.font = `bold ${fontSize}px Arial`;
            tempCtx.fillStyle = 'white';
            tempCtx.textBaseline = 'middle';
            tempCtx.fillText(text, 25, fontSize / 2 + 25);
            
            const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
            const pixels = [];
            const gap = 2; // Khoảng cách giữa các particles - giảm để có nhiều hạt hơn
            
            for (let y = 0; y < imageData.height; y += gap) {
                for (let x = 0; x < imageData.width; x += gap) {
                    const index = (y * imageData.width + x) * 4;
                    const alpha = imageData.data[index + 3];
                    
                    if (alpha > 128) {
                        const centerX = window.innerWidth / 2;
                        const centerY = window.innerHeight / 2;
                        const offsetX = tempCanvas.width / 2;
                        const offsetY = tempCanvas.height / 2;
                        
                        pixels.push({
                            x: centerX + x - offsetX,
                            y: centerY + y - offsetY
                        });
                    }
                }
            }
            
            return pixels;
        }

        // Random colors for particles
        const particleColors = [
            '#FF1493', '#FF00FF', '#9900FF', '#6600FF',
            '#0099FF', '#00FFFF', '#00FF00', '#FFFF00',
            '#FFD700', '#FFA500', '#FF0000', '#FF69B4'
        ];

        // Tạo particles cho chữ đầu tiên
        function createParticles(text) {
            const pixels = getTextPixels(text);
            const newParticles = [];
            
            // Chọn 1 màu duy nhất cho tất cả particles của chữ này
            const color = particleColors[Math.floor(Math.random() * particleColors.length)];
            
            pixels.forEach((pixel, i) => {
                const startX = window.innerWidth / 2;
                const startY = window.innerHeight / 2;
                
                newParticles.push(new Particle(startX, startY, pixel.x, pixel.y, color));
            });
            
            return newParticles;
        }

        // Biến đếm số lần đã hiển thị hết tất cả chữ
        let loopCount = 0;

        // Chuyển sang chữ mới
        function changeWord() {
            // Đợi 1s để người xem đọc chữ trước khi vỡ
            setTimeout(() => {
                currentWordIndex = (currentWordIndex + 1) % words.length;
                
                // Kiểm tra nếu đã hiển thị hết tất cả chữ
                if (currentWordIndex === 0) {
                    loopCount++;
                    // Chuyển sang index2.html sau khi hiển thị hết 1 lần
                    if (loopCount === 1) {
                        setTimeout(() => {
                            // Lưu thời gian nhạc hiện tại (36 giây)
                            localStorage.setItem('musicTime', '34');
                            window.location.href = 'index2.html';
                        }, 1000); // Đợi 1s rồi chuyển trang
                        return;
                    }
                }
                
                const newText = words[currentWordIndex];
                const pixels = getTextPixels(newText);
                
                // Làm particles vỡ ra
                particles.forEach(p => p.explode());
                
                setTimeout(() => {
                // Chọn 1 màu duy nhất cho chữ mới
                const newColor = particleColors[Math.floor(Math.random() * particleColors.length)];
                
                // Tạo particles mới nếu cần
                if (pixels.length > particles.length) {
                    for (let i = particles.length; i < pixels.length; i++) {
                        particles.push(new Particle(
                            window.innerWidth / 2,
                            window.innerHeight / 2,
                            pixels[i].x,
                            pixels[i].y,
                            newColor
                        ));
                    }
                }
                
                // Cập nhật target cho các particles
                particles.forEach((p, i) => {
                    if (i < pixels.length) {
                        p.setTarget(pixels[i].x, pixels[i].y);
                        p.color = newColor; // Tất cả particles cùng màu
                    }
                });
                
                // Xóa particles thừa
                if (particles.length > pixels.length) {
                    particles = particles.slice(0, pixels.length);
                }
                }, 700); // Delay 0.7s trước khi gộp lại
            }, 1000); // Giữ chữ 1s trước khi vỡ
        }

        // Hàm hiển thị đếm ngược
        function showCountdown() {
            if (countdownIndex < countdownNumbers.length) {
                particles = createParticles(countdownNumbers[countdownIndex]);
                countdownIndex++;
                
                setTimeout(() => {
                    particles.forEach(p => p.explode());
                    setTimeout(() => {
                        showCountdown();
                    }, 500);
                }, 800); // Giữ mỗi số 0.8s
            } else {
                // Kết thúc đếm ngược, bắt đầu hiển thị chữ
                isCountingDown = false;
                currentWordIndex = 0;
                particles = createParticles(words[0]);
                setTimeout(() => {
                    setInterval(changeWord, 4000);
                }, 1000); // Hiển thị chữ đầu tiên 1s rồi mới bắt đầu loop
            }
        }

        // Animation loop cho particles
        function animateParticles() {
            textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);
            
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            requestAnimationFrame(animateParticles);
        }

        animateParticles();

        // Xử lý nút Play
        const playButton = document.getElementById('playButton');
        const audio = document.getElementById('backgroundMusic');
        audio.volume = 0.5; // Âm lượng 50%

        playButton.addEventListener('click', () => {
            // Ẩn nút play
            playButton.classList.add('hidden');
            
            // Phát nhạc
            audio.play().catch(e => {
                console.log('Không thể phát nhạc:', e);
            });
            
            // Bắt đầu đếm ngược
            hasStarted = true;
            showCountdown();
        });
    </script>
</body>
</html>

